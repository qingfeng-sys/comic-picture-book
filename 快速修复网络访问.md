# 快速修复网络访问问题

## 🚀 一键修复（推荐）

**以管理员身份运行：**
```
一键修复网络访问.bat
```

或者使用 PowerShell（需要管理员权限）：
```powershell
.\setup-network.ps1
```
然后启动开发服务器：
```powershell
.\start-dev.ps1
```

## 🔍 诊断问题

运行诊断脚本查看问题：
```
诊断网络问题.bat
```

或者：
```powershell
.\diagnose-network-access.ps1
```

## ✅ 已完成的修复

1. **修复了 `next.config.js`**
   - 将 `allowedDevOrigins` 移到 `experimental` 对象中（Next.js 16 要求）

2. **修复了 API 路由的 CORS 配置**
   - 修复了 `Access-Control-Allow-Credentials` 与 `Access-Control-Allow-Origin: *` 的冲突
   - 现在会根据请求的 origin 动态设置 CORS 头

3. **创建了诊断和修复工具**
   - `diagnose-network-access.ps1` - 全面诊断网络访问问题
   - `setup-network.ps1` - 配置防火墙/显示 IP/验证监听
   - `一键修复网络访问.bat` - 方便使用的批处理文件
   - `诊断网络问题.bat` - 方便使用的诊断工具

## 📋 修复步骤清单

- [ ] 运行 `一键修复网络访问.bat`（需要管理员权限）
- [ ] 查找你的 IP 地址（修复脚本会显示）
- [ ] 完全停止当前服务器（Ctrl+C）
- [ ] 重新启动服务器：`npm run dev`
- [ ] 使用实际 IP 地址访问（如 `http://192.168.1.199:3000`）
- [ ] 测试故事脚本生成功能
- [ ] 测试绘本生成功能

## ⚠️ 重要提示

1. **不要使用 `http://0.0.0.0:3000` 访问**
   - `0.0.0.0` 只是监听地址，不是访问地址
   - 必须使用你的实际 IP 地址（如 `192.168.x.x:3000`）

2. **确保防火墙规则已设置**
   - 修复脚本会自动设置，但需要管理员权限

3. **确保服务器监听 0.0.0.0**
   - `package.json` 中的 `dev` 脚本应该包含 `-H 0.0.0.0`
   - 如未配置，请手动调整后重启开发服务器

4. **从其他设备访问时**
   - 确保设备在同一网络（同一 WiFi/局域网）
   - 使用服务器的实际 IP 地址，不是 localhost

## 📖 详细文档

查看 `NETWORK_ACCESS_SOLUTION.md` 获取完整的问题排查指南。
