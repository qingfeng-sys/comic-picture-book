# é¡¹ç›®æŠ€æœ¯æ¡†æ¶æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: comic-picture-bookï¼ˆæ¼«ç”»ç»˜æœ¬åˆ›ä½œåº”ç”¨ï¼‰  
**é¡¹ç›®æè¿°**: AIé©±åŠ¨çš„æ™ºèƒ½æ¼«ç”»ç»˜æœ¬åˆ›ä½œå·¥å…·ï¼Œæ”¯æŒæ•…äº‹è„šæœ¬ç”Ÿæˆå’Œè‡ªåŠ¨ç”Ÿæˆå¡é€šé£æ ¼æ¼«ç”»ç»˜æœ¬  
**å¼€å‘æ¨¡å¼**: SPAï¼ˆå•é¡µåº”ç”¨ï¼‰æ¨¡å¼ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“

---

## ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶
- **Next.js**: `^16.0.7` - Reactå…¨æ ˆæ¡†æ¶
- **React**: `^18.3.1` - UIåº“
- **React DOM**: `^18.3.1` - DOMæ¸²æŸ“

### å¼€å‘è¯­è¨€
- **TypeScript**: `^5.0.0` - ç±»å‹å®‰å…¨çš„JavaScriptè¶…é›†
- **é…ç½®**: ä¸¥æ ¼æ¨¡å¼ï¼ŒES2020ç›®æ ‡ï¼Œæ”¯æŒJSX

### æ ·å¼æ–¹æ¡ˆ
- **Tailwind CSS**: `^3.3.0` - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
- **PostCSS**: `^8.4.0` - CSSåå¤„ç†å™¨
- **Autoprefixer**: `^10.4.0` - è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€

### HTTPå®¢æˆ·ç«¯
- **Axios**: `^1.6.0` - PromiseåŸºç¡€çš„HTTPå®¢æˆ·ç«¯

### AIæœåŠ¡é›†æˆ
- **DeepSeek API**: ç”¨äºæ•…äº‹è„šæœ¬ç”Ÿæˆå’Œå¯¹è¯äº¤äº’
- **ä¸ƒç‰›äº‘API** (qnaigc.com): ç”¨äºå›¾åƒç”Ÿæˆï¼ˆå¡é€šé£æ ¼æ¼«ç”»ï¼‰

---

## ğŸ“ é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„
```
comic-picture-book/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # APIè·¯ç”±ï¼ˆæœåŠ¡ç«¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ script/
â”‚   â”‚   â”‚   â””â”€â”€ generate/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts      # è„šæœ¬ç”ŸæˆAPI
â”‚   â”‚   â””â”€â”€ comic/
â”‚   â”‚       â””â”€â”€ generate/
â”‚   â”‚           â””â”€â”€ route.ts      # æ¼«ç”»ç”ŸæˆAPI
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€ï¼ˆå®¢æˆ·ç«¯ç»„ä»¶ï¼‰
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µï¼ˆå®¢æˆ·ç«¯ç»„ä»¶ï¼‰
â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ components/                   # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ScriptGenerator/          # è„šæœ¬ç”Ÿæˆå™¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ScriptGenerator.tsx
â”‚   â”œâ”€â”€ ComicGenerator/           # æ¼«ç”»ç”Ÿæˆå™¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ComicGenerator.tsx
â”‚   â”œâ”€â”€ ComicPageCanvas/          # æ¼«ç”»é¡µé¢ç”»å¸ƒç»„ä»¶
â”‚   â”‚   â””â”€â”€ ComicPageCanvas.tsx
â”‚   â””â”€â”€ ChatInterface/            # å¯¹è¯äº¤äº’ç»„ä»¶
â”‚       â””â”€â”€ ChatInterface.tsx
â”‚
â”œâ”€â”€ lib/                          # å·¥å…·åº“
â”‚   â”œâ”€â”€ deepseek.ts              # DeepSeek APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ qiniu.ts                 # ä¸ƒç‰›äº‘APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ imageGenerator.ts        # å›¾åƒç”Ÿæˆå·¥å…·
â”‚   â””â”€â”€ scriptUtils.ts           # è„šæœ¬å¤„ç†å·¥å…·
â”‚
â”œâ”€â”€ types/                        # TypeScriptç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts                 # å…¨å±€ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ scripts/                      # è„šæœ¬æ–‡ä»¶
â”‚   â””â”€â”€ get-ip-and-start.js      # è·å–IPå¹¶å¯åŠ¨
â”‚
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®
â”œâ”€â”€ next.config.js                # Next.jsé…ç½®
â”œâ”€â”€ tailwind.config.js            # Tailwindé…ç½®
â””â”€â”€ postcss.config.js             # PostCSSé…ç½®
```

---

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### 1. Next.js App Routeræ¶æ„
- ä½¿ç”¨æœ€æ–°çš„App Routerï¼ˆNext.js 13+ï¼‰
- æ”¯æŒæœåŠ¡ç«¯APIè·¯ç”±å’Œå®¢æˆ·ç«¯ç»„ä»¶
- æ–‡ä»¶ç³»ç»Ÿè·¯ç”±

### 2. SPAæ¨¡å¼
- æ‰€æœ‰é¡µé¢ç»„ä»¶ä½¿ç”¨ `'use client'` æŒ‡ä»¤
- å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œæå‡äº¤äº’ä½“éªŒ
- APIè·¯ç”±ä»åœ¨æœåŠ¡ç«¯è¿è¡Œï¼ˆç”¨äºå®‰å…¨å¤„ç†APIå¯†é’¥ï¼‰

### 3. TypeScriptä¸¥æ ¼æ¨¡å¼
- å®Œæ•´çš„ç±»å‹å®šä¹‰
- ç±»å‹å®‰å…¨ä¿è¯
- è·¯å¾„åˆ«åï¼š`@/*` æ˜ å°„åˆ°é¡¹ç›®æ ¹ç›®å½•

### 4. ç½‘ç»œè®¿é—®é…ç½®
- å¼€å‘ç¯å¢ƒæ”¯æŒå±€åŸŸç½‘è®¿é—®ï¼ˆç›‘å¬ `0.0.0.0`ï¼‰
- CORSé…ç½®æ”¯æŒè·¨åŸŸè¯·æ±‚
- Windowsé˜²ç«å¢™è§„åˆ™è‡ªåŠ¨é…ç½®

---

## ğŸ”Œ APIé›†æˆ

### DeepSeek API
**ç”¨é€”**: æ•…äº‹è„šæœ¬ç”Ÿæˆã€å¯¹è¯äº¤äº’ã€ç»“æ„åŒ–åˆ†é•œæ•°æ®ç”Ÿæˆ

**ä¸»è¦åŠŸèƒ½**:
- `generateScriptWithDeepSeek()` - ç”Ÿæˆæ–‡æœ¬è„šæœ¬
- `generateStoryboardWithDeepSeek()` - ç”Ÿæˆç»“æ„åŒ–åˆ†é•œJSON
- `continueConversation()` - ç»§ç»­å¯¹è¯å®Œå–„è„šæœ¬

**é…ç½®**:
- APIç«¯ç‚¹: `https://api.deepseek.com/v1/chat/completions`
- æ¨¡å‹: `deepseek-chat`
- ç¯å¢ƒå˜é‡: `DEEPSEEK_API_KEY`

### ä¸ƒç‰›äº‘API (qnaigc.com)
**ç”¨é€”**: å¡é€šé£æ ¼æ¼«ç”»å›¾åƒç”Ÿæˆ

**ä¸»è¦åŠŸèƒ½**:
- å›¾åƒç”Ÿæˆï¼ˆæ”¯æŒå¤šç§æ¨¡å‹ï¼‰
- å¼‚æ­¥ä»»åŠ¡å¤„ç†
- å›¾åƒURLè¿”å›

**é…ç½®**:
- APIç«¯ç‚¹: `https://api.qnaigc.com/v1`
- ç¯å¢ƒå˜é‡: `QINIU_API_KEY`

---

## ğŸ“¡ APIè·¯ç”±

### `/api/script/generate`
**æ–¹æ³•**: POST  
**åŠŸèƒ½**: ç”Ÿæˆæ•…äº‹è„šæœ¬æˆ–ç»“æ„åŒ–åˆ†é•œæ•°æ®

**è¯·æ±‚å‚æ•°**:
```typescript
{
  prompt: string;                    // ç”¨æˆ·æç¤ºè¯
  conversationHistory?: Array;       // å¯¹è¯å†å²ï¼ˆå¯é€‰ï¼‰
  outputFormat?: 'script' | 'storyboard';  // è¾“å‡ºæ ¼å¼
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data: {
    script?: string;                  // æ–‡æœ¬è„šæœ¬ï¼ˆoutputFormat='script'ï¼‰
    storyboard?: StoryboardData;      // åˆ†é•œæ•°æ®ï¼ˆoutputFormat='storyboard'ï¼‰
  };
  error?: string;
}
```

### `/api/comic/generate`
**æ–¹æ³•**: POST  
**åŠŸèƒ½**: ç”Ÿæˆæ¼«ç”»ç»˜æœ¬é¡µé¢

**è¯·æ±‚å‚æ•°**:
```typescript
{
  scriptSegment?: string;            // æ–‡æœ¬è„šæœ¬ç‰‡æ®µï¼ˆæ—§æ ¼å¼ï¼‰
  storyboard?: StoryboardData;        // åˆ†é•œæ•°æ®ï¼ˆæ–°æ ¼å¼ï¼Œä¼˜å…ˆï¼‰
  startPageNumber?: number;           // èµ·å§‹é¡µç 
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data: {
    pages: ComicPage[];               // ç”Ÿæˆçš„é¡µé¢æ•°ç»„
  };
  error?: string;
}
```

---

## ğŸ¨ æ ¸å¿ƒç»„ä»¶

### ScriptGenerator
- æ•…äº‹è„šæœ¬ç”Ÿæˆç•Œé¢
- æ”¯æŒå¯¹è¯å¼äº¤äº’
- è„šæœ¬ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨

### ComicGenerator
- æ¼«ç”»ç»˜æœ¬ç”Ÿæˆç•Œé¢
- æ”¯æŒè„šæœ¬å¯¼å…¥å’Œé€‰æ‹©
- è‡ªåŠ¨åˆ‡åˆ†é•¿è„šæœ¬ï¼ˆ10é¡µä¸ºå•ä½ï¼‰

### ComicPageCanvas
- æ¼«ç”»é¡µé¢æ¸²æŸ“ç»„ä»¶
- æ”¯æŒå¯¹è¯æ°”æ³¡ã€æ—ç™½æ˜¾ç¤º
- å›¾åƒå’Œæ–‡æœ¬å¸ƒå±€

### ChatInterface
- å¯¹è¯äº¤äº’ç»„ä»¶
- æ¶ˆæ¯å†å²ç®¡ç†
- å®æ—¶å¯¹è¯åé¦ˆ

---

## ğŸ“¦ æ•°æ®ç±»å‹

### Scriptï¼ˆè„šæœ¬ï¼‰
```typescript
interface Script {
  id: string;
  title: string;
  content: string;
  createdAt: string;
  updatedAt: string;
}
```

### StoryboardDataï¼ˆåˆ†é•œæ•°æ®ï¼‰
```typescript
interface StoryboardData {
  frames: StoryboardFrame[];
}

interface StoryboardFrame {
  frame_id: number;
  image_prompt: string;
  dialogues: DialogueItem[];
  narration?: string;
}

interface DialogueItem {
  role: string;
  text: string;
  anchor: 'left' | 'right' | 'center';
  x_ratio: number;  // 0~1
  y_ratio: number;  // 0~1
}
```

### ComicPageï¼ˆæ¼«ç”»é¡µé¢ï¼‰
```typescript
interface ComicPage {
  pageNumber: number;
  imageUrl: string;
  text: string;
  dialogue?: (string | DialogueItem)[];
  narration?: string;
}
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶

### next.config.js
- Reactä¸¥æ ¼æ¨¡å¼
- å¼€å‘ç¯å¢ƒCORSé…ç½®
- ç¯å¢ƒå˜é‡ä¼ é€’
- å±€åŸŸç½‘è®¿é—®æ”¯æŒ

### tsconfig.json
- ES2020ç›®æ ‡
- ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- è·¯å¾„åˆ«åï¼š`@/*`
- Next.jsæ’ä»¶æ”¯æŒ

### tailwind.config.js
- å†…å®¹è·¯å¾„é…ç½®
- è‡ªå®šä¹‰ä¸»é¢˜è‰²ï¼ˆprimaryï¼‰
- å“åº”å¼æ–­ç‚¹

---

## ğŸ” ç¯å¢ƒå˜é‡

### å¿…éœ€å˜é‡
- `DEEPSEEK_API_KEY`: DeepSeek APIå¯†é’¥
- `QINIU_API_KEY`: ä¸ƒç‰›äº‘APIå¯†é’¥

### é…ç½®æ–¹å¼
- å¼€å‘ç¯å¢ƒ: `.env.local` æ–‡ä»¶
- ç”Ÿäº§ç¯å¢ƒ: æœåŠ¡å™¨ç¯å¢ƒå˜é‡

---

## ğŸš€ å¼€å‘ä¸éƒ¨ç½²

### å¼€å‘å‘½ä»¤
```bash
npm run dev      # å¼€å‘æœåŠ¡å™¨ï¼ˆç›‘å¬0.0.0.0ï¼‰
npm run build    # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start    # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run lint     # ä»£ç æ£€æŸ¥
```

### ç½‘ç»œè®¿é—®
- å¼€å‘æœåŠ¡å™¨ç›‘å¬ `0.0.0.0:3000`
- æ”¯æŒå±€åŸŸç½‘è®¿é—®
- è‡ªåŠ¨é…ç½®é˜²ç«å¢™è§„åˆ™ï¼ˆWindowsï¼‰

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- TypeScriptä¸¥æ ¼æ¨¡å¼
- ESLinté…ç½®ï¼ˆNext.jsæ¨èï¼‰
- ç»„ä»¶ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ + Hooks

### æ–‡ä»¶å‘½å
- ç»„ä»¶æ–‡ä»¶ï¼šPascalCaseï¼ˆå¦‚ `ComicGenerator.tsx`ï¼‰
- å·¥å…·æ–‡ä»¶ï¼šcamelCaseï¼ˆå¦‚ `scriptUtils.ts`ï¼‰
- APIè·¯ç”±ï¼šå°å†™ï¼ˆå¦‚ `route.ts`ï¼‰

### ç»„ä»¶ç»„ç»‡
- æ¯ä¸ªç»„ä»¶ç‹¬ç«‹ç›®å½•
- ç»„ä»¶æ–‡ä»¶ä¸ç›®å½•åŒå
- ç›¸å…³ç±»å‹å®šä¹‰åœ¨ `types/index.ts`

---

## ğŸ”„ æ•°æ®æµ

### è„šæœ¬ç”Ÿæˆæµç¨‹
1. ç”¨æˆ·è¾“å…¥æç¤ºè¯ â†’ `ScriptGenerator`
2. è°ƒç”¨ `/api/script/generate` â†’ APIè·¯ç”±
3. APIè°ƒç”¨ `deepseek.ts` â†’ DeepSeek API
4. è¿”å›è„šæœ¬æ•°æ® â†’ å‰ç«¯æ˜¾ç¤º
5. ç”¨æˆ·ç¡®è®¤ â†’ ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨

### æ¼«ç”»ç”Ÿæˆæµç¨‹
1. é€‰æ‹©/å¯¼å…¥è„šæœ¬ â†’ `ComicGenerator`
2. è„šæœ¬åˆ‡åˆ†ï¼ˆå¦‚éœ€è¦ï¼‰â†’ `scriptUtils.ts`
3. è°ƒç”¨ `/api/comic/generate` â†’ APIè·¯ç”±
4. è§£æè„šæœ¬/åˆ†é•œ â†’ ç”Ÿæˆå›¾åƒæç¤ºè¯
5. è°ƒç”¨ `qiniu.ts` â†’ ä¸ƒç‰›äº‘APIç”Ÿæˆå›¾åƒ
6. ç»„è£…é¡µé¢æ•°æ® â†’ è¿”å›å‰ç«¯
7. `ComicPageCanvas` æ¸²æŸ“ â†’ æ˜¾ç¤ºæ¼«ç”»

---

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

1. **AIé©±åŠ¨**: é›†æˆDeepSeekå’Œä¸ƒç‰›äº‘AIæœåŠ¡
2. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
3. **ç°ä»£åŒ–æ¶æ„**: Next.js 16 App Router
4. **å“åº”å¼è®¾è®¡**: Tailwind CSSå®ç”¨ä¼˜å…ˆ
5. **SPAä½“éªŒ**: å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œæµç•…äº¤äº’
6. **ç½‘ç»œå‹å¥½**: æ”¯æŒå±€åŸŸç½‘è®¿é—®ï¼Œä¾¿äºå›¢é˜Ÿåä½œ

---

## ğŸ“š ä¾èµ–ç‰ˆæœ¬

### ç”Ÿäº§ä¾èµ–
- next: ^16.0.7
- react: ^18.3.1
- react-dom: ^18.3.1
- axios: ^1.6.0
- openai: ^4.20.0

### å¼€å‘ä¾èµ–
- typescript: ^5.0.0
- @types/node: ^20.0.0
- @types/react: ^18.3.0
- @types/react-dom: ^18.3.0
- tailwindcss: ^3.3.0
- postcss: ^8.4.0
- autoprefixer: ^10.4.0
- eslint: ^9.39.1
- eslint-config-next: ^16.0.7

---

## ğŸ” æŠ€æœ¯æ ˆæ€»ç»“

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| æ¡†æ¶ | Next.js | 16.0.7 | å…¨æ ˆReactæ¡†æ¶ |
| UIåº“ | React | 18.3.1 | ç”¨æˆ·ç•Œé¢ |
| è¯­è¨€ | TypeScript | 5.0.0 | ç±»å‹å®‰å…¨ |
| æ ·å¼ | Tailwind CSS | 3.3.0 | æ ·å¼æ¡†æ¶ |
| HTTP | Axios | 1.6.0 | APIè°ƒç”¨ |
| AIæœåŠ¡ | DeepSeek API | - | è„šæœ¬ç”Ÿæˆ |
| AIæœåŠ¡ | ä¸ƒç‰›äº‘API | - | å›¾åƒç”Ÿæˆ |
| æ„å»º | Next.js Build | - | æ„å»ºå·¥å…· |
| ä»£ç æ£€æŸ¥ | ESLint | 9.39.1 | ä»£ç è´¨é‡ |

---

*æœ€åæ›´æ–°: 2024å¹´*
