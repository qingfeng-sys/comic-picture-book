# é¡¹ç›®æŠ€æœ¯æ¡†æ¶æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: comic-picture-bookï¼ˆæ¼«ç”»ç»˜æœ¬åˆ›ä½œåº”ç”¨ï¼‰  
**é¡¹ç›®æè¿°**: AIé©±åŠ¨çš„æ™ºèƒ½æ¼«ç”»ç»˜æœ¬åˆ›ä½œå·¥å…·ï¼Œæ”¯æŒæ•…äº‹è„šæœ¬ç”Ÿæˆã€è‡ªåŠ¨ç”Ÿæˆå¡é€šé£æ ¼æ¼«ç”»ç»˜æœ¬ã€ç”¨æˆ·è®¤è¯ã€ä½œå“ç®¡ç†ç­‰å®Œæ•´åŠŸèƒ½  
**å¼€å‘æ¨¡å¼**: SPAï¼ˆå•é¡µåº”ç”¨ï¼‰æ¨¡å¼ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“ + Next.js App Router API è·¯ç”±  
**ç‰ˆæœ¬**: 1.0.0
**å®šä½**: æœ¬åœ°/å†…ç½‘æ¼”ç¤ºé¡¹ç›®ï¼Œå°šæœªæ¥å…¥ç”Ÿäº§çº§é‰´æƒä¸æŒä¹…åŒ–

---

## ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶
- **Next.js**: `^16.0.7` - Reactå…¨æ ˆæ¡†æ¶ï¼ˆApp Routerï¼‰
- **React**: `^18.3.1` - UIåº“
- **React DOM**: `^18.3.1` - DOMæ¸²æŸ“

### å¼€å‘è¯­è¨€
- **TypeScript**: `^5.0.0` - ç±»å‹å®‰å…¨çš„JavaScriptè¶…é›†
- **é…ç½®**: ä¸¥æ ¼æ¨¡å¼ï¼ŒES2020ç›®æ ‡ï¼Œæ”¯æŒJSX

### æ ·å¼æ–¹æ¡ˆ
- **Tailwind CSS**: `^3.3.0` - å®ç”¨ä¼˜å…ˆçš„CSSæ¡†æ¶
- **PostCSS**: `^8.4.0` - CSSåå¤„ç†å™¨
- **Autoprefixer**: `^10.4.0` - è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€

### HTTPå®¢æˆ·ç«¯
- **Axios**: `^1.6.0` - PromiseåŸºç¡€çš„HTTPå®¢æˆ·ç«¯

### å·¥å…·åº“
- **JSZip**: `^3.10.1` - ZIPæ–‡ä»¶ç”Ÿæˆå’Œæ‰“åŒ…å·¥å…·

### AIæœåŠ¡é›†æˆ
- **DashScopeï¼ˆé˜¿é‡Œäº‘ç™¾ç‚¼ï¼‰æ–‡æœ¬ç”Ÿæˆ**: ç”¨äºæ•…äº‹å¤§çº²/å‰§æœ¬/åˆ†é•œç”Ÿæˆï¼ˆç»Ÿä¸€èµ° `text-generation/generation`ï¼‰
- **ä¸ƒç‰›äº‘API** (qnaigc.com): ç”¨äºå›¾åƒç”Ÿæˆï¼ˆå¡é€šé£æ ¼æ¼«ç”»ï¼‰
- **é€šä¹‰ä¸‡ç›¸ï¼ˆDashScope æ–‡ç”Ÿå›¾ï¼Œå¯é€‰ï¼‰**: ç”¨äºå›¾åƒç”Ÿæˆï¼ˆå¼‚æ­¥ä»»åŠ¡æ¨¡å¼ï¼‰

---

## ğŸ“ é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„
```
comic-picture-book/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # APIè·¯ç”±ï¼ˆæœåŠ¡ç«¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ script/
â”‚   â”‚   â”‚   â””â”€â”€ generate/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts      # è„šæœ¬ç”ŸæˆAPI
â”‚   â”‚   â””â”€â”€ comic/
â”‚   â”‚       â”œâ”€â”€ generate/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts      # æ¼«ç”»ç”ŸæˆAPI
â”‚   â”‚       â”œâ”€â”€ save/
â”‚   â”‚       â”‚   â””â”€â”€ route.ts      # å›¾ç‰‡ä¿å­˜API
â”‚   â”‚       â””â”€â”€ cleanup/
â”‚   â”‚           â””â”€â”€ route.ts      # å›¾ç‰‡æ¸…ç†API
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€ï¼ˆå®¢æˆ·ç«¯ç»„ä»¶ï¼‰
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µï¼ˆå®¢æˆ·ç«¯ç»„ä»¶ï¼‰
â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ components/                   # Reactç»„ä»¶
â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â””â”€â”€ LoginModal.tsx       # ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â””â”€â”€ MainLayout.tsx        # ä¸»å¸ƒå±€ï¼ˆä¾§è¾¹æ å¯¼èˆªï¼‰
â”‚   â”œâ”€â”€ ScriptGenerator/         # è„šæœ¬ç”Ÿæˆå™¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ScriptGenerator.tsx
â”‚   â”œâ”€â”€ ComicGenerator/           # æ¼«ç”»ç”Ÿæˆå™¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ComicGenerator.tsx
â”‚   â”œâ”€â”€ ComicPageCanvas/          # æ¼«ç”»é¡µé¢ç”»å¸ƒç»„ä»¶
â”‚   â”‚   â””â”€â”€ ComicPageCanvas.tsx
â”‚   â”œâ”€â”€ ComicViewer/              # æ¼«ç”»æŸ¥çœ‹å™¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ComicViewer.tsx
â”‚   â”œâ”€â”€ ChatInterface/            # å¯¹è¯äº¤äº’ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ChatInterface.tsx
â”‚   â””â”€â”€ PersonalCenter/           # ä¸ªäººä¸­å¿ƒç»„ä»¶
â”‚       â””â”€â”€ PersonalCenter.tsx
â”‚
â”œâ”€â”€ lib/                          # å·¥å…·åº“
â”‚   â”œâ”€â”€ dashscope.ts             # DashScope æ–‡æœ¬ç”Ÿæˆå®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ storyGenerator.ts        # æ•…äº‹ç”Ÿæˆä¸‰é˜¶æ®µ pipelineï¼ˆå¤§çº²â†’å‰§æœ¬â†’åˆ†é•œï¼‰
â”‚   â”œâ”€â”€ qiniu.ts                 # ä¸ƒç‰›äº‘APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ imageGenerator.ts        # å›¾åƒç”Ÿæˆå·¥å…·
â”‚   â”œâ”€â”€ wan.ts                   # é€šä¹‰ä¸‡ç›¸ï¼ˆDashScope æ–‡ç”Ÿå›¾ï¼‰å®¢æˆ·ç«¯ï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰
â”‚   â”œâ”€â”€ scriptUtils.ts           # è„šæœ¬å¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ authUtils.ts             # ç”¨æˆ·è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ downloadUtils.ts         # ä¸‹è½½å·¥å…·ï¼ˆæ”¯æŒZIPæ‰“åŒ…ï¼‰
â”‚   â”œâ”€â”€ comicPageRenderer.ts     # å®¢æˆ·ç«¯å¯¼å‡ºæ¸²æŸ“ï¼šå›¾ç‰‡+æ°”æ³¡+æ—ç™½ç»˜åˆ¶åˆ°Canvas
â”‚   â””â”€â”€ imageStorage.ts          # å›¾ç‰‡å­˜å‚¨å·¥å…·
â”‚
â”œâ”€â”€ types/                        # TypeScriptç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts                 # å…¨å±€ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”‚   â””â”€â”€ comic-assets/            # æ¼«ç”»å›¾ç‰‡å­˜å‚¨ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ scripts/                      # è„šæœ¬æ–‡ä»¶
â”‚   â””â”€â”€ get-ip-and-start.js      # è·å–IPå¹¶å¯åŠ¨
â”‚
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®
â”œâ”€â”€ next.config.js                # Next.jsé…ç½®
â”œâ”€â”€ tailwind.config.js            # Tailwindé…ç½®
â””â”€â”€ postcss.config.js             # PostCSSé…ç½®
```

---

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### 1. Next.js App Routeræ¶æ„
- ä½¿ç”¨æœ€æ–°çš„App Routerï¼ˆNext.js 13+ï¼‰
- æ”¯æŒæœåŠ¡ç«¯APIè·¯ç”±å’Œå®¢æˆ·ç«¯ç»„ä»¶
- æ–‡ä»¶ç³»ç»Ÿè·¯ç”±

### 2. SPAæ¨¡å¼
- æ‰€æœ‰é¡µé¢ç»„ä»¶ä½¿ç”¨ `'use client'` æŒ‡ä»¤
- å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œæå‡äº¤äº’ä½“éªŒ
- APIè·¯ç”±ä»åœ¨æœåŠ¡ç«¯è¿è¡Œï¼ˆç”¨äºå®‰å…¨å¤„ç†APIå¯†é’¥ï¼‰
- çŠ¶æ€æŒä¹…åŒ–ï¼ˆä½¿ç”¨sessionStorageï¼‰

### 3. TypeScriptä¸¥æ ¼æ¨¡å¼
- å®Œæ•´çš„ç±»å‹å®šä¹‰
- ç±»å‹å®‰å…¨ä¿è¯
- è·¯å¾„åˆ«åï¼š`@/*` æ˜ å°„åˆ°é¡¹ç›®æ ¹ç›®å½•

### 4. ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- åŸºäº localStorage çš„æ¼”ç¤ºçº§ç”¨æˆ·è®¤è¯ï¼ˆæ— åç«¯é‰´æƒ/å¯†ç åŠ å¯†ï¼Œä¸å¯ç”¨äºç”Ÿäº§ï¼‰
- æ”¯æŒæ³¨å†Œã€ç™»å½•ã€ç™»å‡º
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†ï¼ˆVIPçŠ¶æ€ã€æ˜µç§°ç­‰ï¼‰

### 5. å›¾ç‰‡å­˜å‚¨ç³»ç»Ÿ
- è‡ªåŠ¨ä¿å­˜ç”Ÿæˆçš„å›¾ç‰‡åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ `public/comic-assets/`ï¼ˆå…¬å¼€é™æ€ç›®å½•ï¼Œç”Ÿäº§éœ€æ›¿æ¢ä¸ºå¯¹è±¡å­˜å‚¨ï¼‰
- æ”¯æŒbase64å’ŒURLä¸¤ç§æ ¼å¼
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸå›¾ç‰‡ï¼ˆ7å¤©è¿‡æœŸï¼‰
- å®šæ—¶æ¸…ç†ä»»åŠ¡ï¼ˆ24å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰

### 6. ä¸‹è½½åŠŸèƒ½
- æ”¯æŒå•å¼ å›¾ç‰‡ä¸‹è½½
- æ”¯æŒæ‰¹é‡ä¸‹è½½ï¼ˆZIPæ‰“åŒ…ï¼‰
- æ”¯æŒCanvaså¯¼å‡º
- å¯¼å‡ºå›¾ç‰‡ä¼šåŒ…å«â€œå¯¹è¯æ°”æ³¡/æ—ç™½â€ï¼ˆé€šè¿‡ `lib/comicPageRenderer.ts` ç¦»å±æ¸²æŸ“ï¼‰ï¼Œé¿å…ä¸‹è½½åˆ°æœ¬åœ°åæ°”æ³¡ç¼ºå¤±

### 7. ç½‘ç»œè®¿é—®é…ç½®
- å¼€å‘ç¯å¢ƒæ”¯æŒå±€åŸŸç½‘è®¿é—®ï¼ˆç›‘å¬ `0.0.0.0`ï¼‰
- CORSé…ç½®æ”¯æŒè·¨åŸŸè¯·æ±‚
- Windowsé˜²ç«å¢™è§„åˆ™è‡ªåŠ¨é…ç½®

### 8. ç§»åŠ¨ç«¯é€‚é…
- å“åº”å¼å¸ƒå±€
- ç§»åŠ¨ç«¯ä¾§è¾¹æ è‡ªåŠ¨æ”¶èµ·
- è§¦æ‘¸å‹å¥½çš„äº¤äº’è®¾è®¡

---

## ğŸ”Œ APIé›†æˆ

### DashScopeï¼ˆé˜¿é‡Œäº‘ç™¾ç‚¼ï¼‰æ–‡æœ¬ç”Ÿæˆ
**ç”¨é€”**: æ•…äº‹å¤§çº²ç”Ÿæˆï¼ˆJSONï¼‰ã€æ•…äº‹å‰§æœ¬ç”Ÿæˆï¼ˆåŠç»“æ„åŒ–æ–‡æœ¬ï¼‰ã€åˆ†é•œç»“æ„åŒ–ï¼ˆJSONï¼‰

**ä¸»è¦åŠŸèƒ½**:
- `generateOutline()` - ç”Ÿæˆæ•…äº‹å¤§çº²ï¼ˆJSONï¼‰
- `generateStoryScript()` - ç”Ÿæˆæ•…äº‹å‰§æœ¬ï¼ˆåŠç»“æ„åŒ–æ–‡æœ¬ï¼‰
- `generateStoryboard()` - ç”Ÿæˆç»“æ„åŒ–åˆ†é•œï¼ˆJSONï¼‰
- `continueStoryConversation()` - ç»§ç»­å¯¹è¯å®Œå–„å‰§æœ¬

**é…ç½®**:
- APIç«¯ç‚¹: `https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation`
- ç¯å¢ƒå˜é‡: `DASHSCOPE_API_KEY`
- å®¢æˆ·ç«¯å°è£…: `lib/dashscope.ts`
- ä¸šåŠ¡ç¼–æ’: `lib/storyGenerator.ts`

**ä¸‰é˜¶æ®µæ¨¡å‹é€‰æ‹©ï¼ˆå¸¦å¤±è´¥å›é€€ï¼‰**:
- **å¤§çº²ï¼ˆJSONï¼‰**: `qwen-flash`ï¼ˆ`enable_thinking=false`ï¼‰â†’ `qwen3-30b-a3b-instruct-2507` â†’ `deepseek-r1-distill-qwen-14b`
- **å‰§æœ¬ï¼ˆåŠç»“æ„åŒ–æ–‡æœ¬ï¼‰**: `qwen2.5-72b-instruct` â†’ `deepseek-v3.2` â†’ `deepseek-r1-distill-qwen-32b` â†’ `deepseek-r1-distill-qwen-14b`
- **åˆ†é•œï¼ˆJSONï¼‰**: `qwen3-next-80b-a3b-instruct` â†’ `qwen2.5-72b-instruct` â†’ `qwen3-max`

### ä¸ƒç‰›äº‘API (qnaigc.com)
**ç”¨é€”**: å¡é€šé£æ ¼æ¼«ç”»å›¾åƒç”Ÿæˆ

**ä¸»è¦åŠŸèƒ½**:
- å›¾åƒç”Ÿæˆï¼ˆåŒæ­¥æ¨¡å¼ï¼‰
- æ”¯æŒå¤šç§å‚æ•°ï¼ˆnegative_prompt, aspect_ratio, human_fidelityç­‰ï¼‰

**é…ç½®**:
- APIç«¯ç‚¹: `https://api.qnaigc.com/v1`
- æ¨¡å‹: `gemini-2.5-flash-image`ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
- ç¯å¢ƒå˜é‡: `QINIU_API_KEY`
- æ¨¡å¼: åŒæ­¥ä»»åŠ¡æ¨¡å¼ï¼ˆç›´æ¥è¿”å›å›¾ç‰‡URLï¼‰

---

## ğŸ“¡ APIè·¯ç”±

### `/api/script/generate`
**æ–¹æ³•**: POST  
**åŠŸèƒ½**: ç”Ÿæˆæ•…äº‹è„šæœ¬æˆ–ç»“æ„åŒ–åˆ†é•œæ•°æ®

**è¯·æ±‚å‚æ•°**:
```typescript
{
  prompt: string;                    // ç”¨æˆ·æç¤ºè¯
  conversationHistory?: Array;       // å¯¹è¯å†å²ï¼ˆå¯é€‰ï¼‰
  outputFormat?: 'script' | 'storyboard';  // è¾“å‡ºæ ¼å¼
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data: {
    script?: string;                  // æ–‡æœ¬è„šæœ¬ï¼ˆoutputFormat='script'ï¼‰
    storyboard?: StoryboardData;      // åˆ†é•œæ•°æ®ï¼ˆoutputFormat='storyboard'ï¼‰
  };
  error?: string;
}
```

### `/api/comic/generate`
**æ–¹æ³•**: POST  
**åŠŸèƒ½**: ç”Ÿæˆæ¼«ç”»ç»˜æœ¬é¡µé¢

**è¯·æ±‚å‚æ•°**:
```typescript
{
  scriptSegment?: string;            // æ–‡æœ¬è„šæœ¬ç‰‡æ®µï¼ˆæ—§æ ¼å¼ï¼‰
  storyboard?: StoryboardData;        // åˆ†é•œæ•°æ®ï¼ˆæ–°æ ¼å¼ï¼Œä¼˜å…ˆï¼‰
  startPageNumber?: number;           // èµ·å§‹é¡µç 
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data: {
    pages: ComicPage[];               // ç”Ÿæˆçš„é¡µé¢æ•°ç»„
  };
  error?: string;
}
```

### `/api/comic/save`
**æ–¹æ³•**: POST  
**åŠŸèƒ½**: ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨

**è¯·æ±‚å‚æ•°**:
```typescript
{
  imageUrl: string;                   // å›¾ç‰‡URLï¼ˆæ”¯æŒbase64ï¼‰
  pageNumber: number;                 // é¡µç 
  scriptId?: string;                  // è„šæœ¬IDï¼ˆå¯é€‰ï¼‰
  segmentId?: number;                 // ç‰‡æ®µIDï¼ˆå¯é€‰ï¼‰
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data: {
    url: string;                       // ä¿å­˜åçš„æœ¬åœ°URL
    fileName: string;                  // æ–‡ä»¶å
    expiresAt: string;                // è¿‡æœŸæ—¶é—´ï¼ˆISOæ ¼å¼ï¼‰
  };
  error?: string;
}
```

### `/api/comic/cleanup`
**æ–¹æ³•**: GET  
**åŠŸèƒ½**: æ¸…ç†è¿‡æœŸçš„å›¾ç‰‡æ–‡ä»¶

**å“åº”æ ¼å¼**:
```typescript
{
  success: boolean;
  data: {
    deletedCount: number;              // åˆ é™¤çš„æ–‡ä»¶æ•°é‡
    message: string;                   // æ¸…ç†ç»“æœæ¶ˆæ¯
  };
  error?: string;
}
```

---

## ğŸ¨ æ ¸å¿ƒç»„ä»¶

### MainLayout
- ä¸»å¸ƒå±€ç»„ä»¶ï¼ŒåŒ…å«ä¾§è¾¹æ å¯¼èˆª
- å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯è‡ªåŠ¨æ”¶èµ·ï¼‰
- ç”¨æˆ·è®¤è¯çŠ¶æ€ç®¡ç†
- é¡µé¢å¯¼èˆªæ§åˆ¶

### ScriptGenerator
- æ•…äº‹è„šæœ¬ç”Ÿæˆç•Œé¢
- æ”¯æŒå¯¹è¯å¼äº¤äº’
- è„šæœ¬ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨

### ComicGenerator
- æ¼«ç”»ç»˜æœ¬ç”Ÿæˆç•Œé¢
- æ”¯æŒè„šæœ¬å¯¼å…¥å’Œé€‰æ‹©
- è‡ªåŠ¨åˆ‡åˆ†é•¿è„šæœ¬ï¼ˆ10é¡µä¸ºå•ä½ï¼‰
- å›¾ç‰‡è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨

### ComicPageCanvas
- æ¼«ç”»é¡µé¢æ¸²æŸ“ç»„ä»¶
- æ”¯æŒå¯¹è¯æ°”æ³¡ã€æ—ç™½æ˜¾ç¤º
- å›¾åƒå’Œæ–‡æœ¬å¸ƒå±€
- æ”¯æŒCanvaså¯¼å‡º

### ComicViewer
- æ¼«ç”»æŸ¥çœ‹å™¨ç»„ä»¶
- æ”¯æŒç¿»é¡µæµè§ˆ
- æ”¯æŒä¸‹è½½åŠŸèƒ½

### PersonalCenter
- ä¸ªäººä¸­å¿ƒç»„ä»¶
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- ä½œå“ç®¡ç†

### LoginModal
- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡†
- ç”¨æˆ·è®¤è¯åŠŸèƒ½

### ChatInterface
- å¯¹è¯äº¤äº’ç»„ä»¶
- æ¶ˆæ¯å†å²ç®¡ç†
- å®æ—¶å¯¹è¯åé¦ˆ

---

## ğŸ“¦ æ•°æ®ç±»å‹

### Userï¼ˆç”¨æˆ·ï¼‰
```typescript
interface User {
  id: string;
  username: string;
  email?: string;
  nickname: string;
  avatar?: string;
  isVip: boolean;
  createdAt: string;
}
```

### Scriptï¼ˆè„šæœ¬ï¼‰
```typescript
interface Script {
  id: string;
  title: string;
  content: string;
  createdAt: string;
  updatedAt: string;
}
```

### StoryboardDataï¼ˆåˆ†é•œæ•°æ®ï¼‰
```typescript
interface StoryboardData {
  frames: StoryboardFrame[];
}

interface StoryboardFrame {
  frame_id: number;
  image_prompt: string;
  dialogues: DialogueItem[];
  narration?: string;
}

interface DialogueItem {
  role: string;
  text: string;
  anchor: 'left' | 'right' | 'center';
  x_ratio: number;  // 0~1
  y_ratio: number;  // 0~1
}
```

### ComicPageï¼ˆæ¼«ç”»é¡µé¢ï¼‰
```typescript
interface ComicPage {
  pageNumber: number;
  imageUrl: string;
  text: string;
  dialogue?: (string | DialogueItem)[];
  narration?: string;
}
```

### ComicBookï¼ˆæ¼«ç”»ä¹¦ï¼‰
```typescript
interface ComicBook {
  id: string;
  scriptId: string;
  segmentId: number;
  title: string;
  pages: ComicPage[];
  createdAt: string;
  updatedAt?: string;
}
```

---

## ğŸ”§ å·¥å…·åº“è¯´æ˜

### authUtils.ts
- `getCurrentUser()` - è·å–å½“å‰ç”¨æˆ·
- `saveUser()` - ä¿å­˜ç”¨æˆ·ä¿¡æ¯
- `isLoggedIn()` - æ£€æŸ¥ç™»å½•çŠ¶æ€
- `logout()` - ç”¨æˆ·ç™»å‡º
- `register()` - æ³¨å†Œæ–°ç”¨æˆ·
- `login()` - ç”¨æˆ·ç™»å½•

### downloadUtils.ts
- `downloadImageFromUrl()` - ä»URLä¸‹è½½å›¾ç‰‡
- `downloadImageFromCanvas()` - ä»Canvasä¸‹è½½å›¾ç‰‡
- `downloadImagesAsZip()` - æ‰¹é‡ä¸‹è½½å¹¶æ‰“åŒ…æˆZIP
- `downloadCanvasesAsZip()` - ä»Canvasæ•°ç»„æ‰“åŒ…ä¸‹è½½

### imageStorage.ts
- `ensureStorageDir()` - ç¡®ä¿å­˜å‚¨ç›®å½•å­˜åœ¨
- `saveImageToStorage()` - ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
- `cleanupExpiredImages()` - æ¸…ç†è¿‡æœŸå›¾ç‰‡

### scriptUtils.ts
- `extractStoryboardFromScript()` - ä»è„šæœ¬æå–åˆ†é•œæ•°æ®
- `splitScriptIntoSegments()` - åˆ‡åˆ†è„šæœ¬ä¸ºç‰‡æ®µ
- `loadScriptsFromStorage()` - ä»æœ¬åœ°å­˜å‚¨åŠ è½½è„šæœ¬
- `saveScriptToStorage()` - ä¿å­˜è„šæœ¬åˆ°æœ¬åœ°å­˜å‚¨
- `loadComicBooksFromStorage()` - ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ¼«ç”»ä¹¦
- `saveComicBookToStorage()` - ä¿å­˜æ¼«ç”»ä¹¦åˆ°æœ¬åœ°å­˜å‚¨
- `deleteComicBookFromStorage()` - åˆ é™¤æ¼«ç”»ä¹¦

---

## âš™ï¸ é…ç½®æ–‡ä»¶

### next.config.js
- Reactä¸¥æ ¼æ¨¡å¼
- å¼€å‘ç¯å¢ƒCORSé…ç½®
- ç¯å¢ƒå˜é‡ä¼ é€’
- å±€åŸŸç½‘è®¿é—®æ”¯æŒ

### tsconfig.json
- ES2020ç›®æ ‡
- ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- è·¯å¾„åˆ«åï¼š`@/*`
- Next.jsæ’ä»¶æ”¯æŒ

### tailwind.config.js
- å†…å®¹è·¯å¾„é…ç½®
- è‡ªå®šä¹‰ä¸»é¢˜è‰²ï¼ˆprimary, softç³»åˆ—ï¼‰
- å“åº”å¼æ–­ç‚¹

---

## ğŸ” ç¯å¢ƒå˜é‡

### å¿…éœ€å˜é‡
- `DASHSCOPE_API_KEY`: DashScope APIå¯†é’¥ï¼ˆç”¨äºæ•…äº‹å¤§çº²/å‰§æœ¬/åˆ†é•œç”Ÿæˆï¼›ä¹Ÿå¯ç”¨äºé€šä¹‰ä¸‡ç›¸æ–‡ç”Ÿå›¾ï¼‰
- `QINIU_API_KEY`: ä¸ƒç‰›äº‘APIå¯†é’¥

### å¯é€‰å˜é‡
- `ENABLE_API_KEY_VERIFICATION`: æ˜¯å¦å¯ç”¨APIå¯†é’¥éªŒè¯ï¼ˆé»˜è®¤falseï¼‰
- DashScope æ–‡æœ¬ç”Ÿæˆè¶…æ—¶ï¼ˆæ¯«ç§’ï¼Œé€‚ç”¨äºå¤§æ¨¡å‹é«˜å³°æœŸï¼‰ï¼š
  - `DASHSCOPE_TIMEOUT_MS`
  - `DASHSCOPE_OUTLINE_TIMEOUT_MS`
  - `DASHSCOPE_SCRIPT_TIMEOUT_MS`
  - `DASHSCOPE_STORYBOARD_TIMEOUT_MS`
  - `DASHSCOPE_CHAT_TIMEOUT_MS`

### é…ç½®æ–¹å¼
- å¼€å‘ç¯å¢ƒ: `.env.local` æ–‡ä»¶
- ç”Ÿäº§ç¯å¢ƒ: æœåŠ¡å™¨ç¯å¢ƒå˜é‡
- æ³¨æ„ï¼š`lib/qiniu.ts` åœ¨å¼€å‘æ¨¡å¼ä¸‹å­˜åœ¨å›é€€å¯†é’¥ï¼ˆä»…ç”¨äºæœ¬åœ°è°ƒè¯•ï¼‰ï¼Œç”Ÿäº§éƒ¨ç½²å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–å¹¶ç¦ç”¨è¯¥å›é€€ã€‚

---

## ğŸš€ å¼€å‘ä¸éƒ¨ç½²

### å¼€å‘å‘½ä»¤
```bash
npm run dev      # å¼€å‘æœåŠ¡å™¨ï¼ˆç›‘å¬0.0.0.0ï¼‰
npm run build    # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start    # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run lint     # ä»£ç æ£€æŸ¥
```

### ç½‘ç»œè®¿é—®
- å¼€å‘æœåŠ¡å™¨ç›‘å¬ `0.0.0.0:3000`
- æ”¯æŒå±€åŸŸç½‘è®¿é—®
- è‡ªåŠ¨é…ç½®é˜²ç«å¢™è§„åˆ™ï¼ˆWindowsï¼‰

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- TypeScriptä¸¥æ ¼æ¨¡å¼
- ESLinté…ç½®ï¼ˆNext.jsæ¨èï¼‰
- ç»„ä»¶ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ + Hooks

### æ–‡ä»¶å‘½å
- ç»„ä»¶æ–‡ä»¶ï¼šPascalCaseï¼ˆå¦‚ `ComicGenerator.tsx`ï¼‰
- å·¥å…·æ–‡ä»¶ï¼šcamelCaseï¼ˆå¦‚ `scriptUtils.ts`ï¼‰
- APIè·¯ç”±ï¼šå°å†™ï¼ˆå¦‚ `route.ts`ï¼‰

### ç»„ä»¶ç»„ç»‡
- æ¯ä¸ªç»„ä»¶ç‹¬ç«‹ç›®å½•
- ç»„ä»¶æ–‡ä»¶ä¸ç›®å½•åŒå
- ç›¸å…³ç±»å‹å®šä¹‰åœ¨ `types/index.ts`

### çŠ¶æ€ç®¡ç†
- ä½¿ç”¨React Hooksï¼ˆuseState, useEffectï¼‰
- æœ¬åœ°å­˜å‚¨ï¼šlocalStorageï¼ˆæŒä¹…åŒ–æ•°æ®ï¼‰
- ä¼šè¯å­˜å‚¨ï¼šsessionStorageï¼ˆä¸´æ—¶çŠ¶æ€ï¼‰

---

## ğŸ”„ æ•°æ®æµ

### è„šæœ¬ç”Ÿæˆæµç¨‹
1. ç”¨æˆ·è¾“å…¥æç¤ºè¯ â†’ `ScriptGenerator`
2. è°ƒç”¨ `/api/script/generate` â†’ APIè·¯ç”±
3. APIè°ƒç”¨ `storyGenerator.ts` â†’ DashScope æ–‡æœ¬ç”Ÿæˆï¼ˆä¸‰é˜¶æ®µï¼šå¤§çº²â†’å‰§æœ¬â†’åˆ†é•œï¼‰
4. è¿”å›è„šæœ¬/åˆ†é•œæ•°æ® â†’ å‰ç«¯æ˜¾ç¤º
5. ç”¨æˆ·ç¡®è®¤ â†’ ä¿å­˜åˆ°localStorage

### æ¼«ç”»ç”Ÿæˆæµç¨‹
1. é€‰æ‹©/å¯¼å…¥è„šæœ¬ â†’ `ComicGenerator`
2. è„šæœ¬åˆ‡åˆ†ï¼ˆå¦‚éœ€è¦ï¼‰â†’ `scriptUtils.ts`
3. è°ƒç”¨ `/api/comic/generate` â†’ APIè·¯ç”±
4. è§£æè„šæœ¬/åˆ†é•œ â†’ ç”Ÿæˆå›¾åƒæç¤ºè¯
5. è°ƒç”¨ `qiniu.ts` â†’ ä¸ƒç‰›äº‘APIç”Ÿæˆå›¾åƒ
6. è°ƒç”¨ `/api/comic/save` â†’ ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
7. ç»„è£…é¡µé¢æ•°æ® â†’ è¿”å›å‰ç«¯
8. `ComicPageCanvas` æ¸²æŸ“ â†’ æ˜¾ç¤ºæ¼«ç”»
9. ä¿å­˜æ¼«ç”»ä¹¦åˆ°localStorage

### ç”¨æˆ·è®¤è¯æµç¨‹
1. ç”¨æˆ·ç‚¹å‡»ç™»å½• â†’ `LoginModal`
2. è¾“å…¥ç”¨æˆ·åå¯†ç  â†’ `authUtils.login()`
3. éªŒè¯ç”¨æˆ·ä¿¡æ¯ â†’ localStorage
4. ä¿å­˜ç”¨æˆ·ä¿¡æ¯ â†’ localStorage
5. æ›´æ–°UIçŠ¶æ€ â†’ `MainLayout`

### å›¾ç‰‡æ¸…ç†æµç¨‹
1. åº”ç”¨å¯åŠ¨ â†’ `layout.tsx` useEffect
2. è°ƒç”¨ `/api/comic/cleanup` â†’ APIè·¯ç”±
3. æ‰«æå­˜å‚¨ç›®å½• â†’ `imageStorage.ts`
4. æ£€æŸ¥è¿‡æœŸæ—¶é—´ â†’ åˆ é™¤è¿‡æœŸæ–‡ä»¶
5. è¿”å›æ¸…ç†ç»“æœ â†’ å‰ç«¯æ—¥å¿—

---

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

1. **AIé©±åŠ¨**: é›†æˆ DashScopeï¼ˆæ–‡æœ¬ç”Ÿæˆï¼‰ä¸ä¸ƒç‰›äº‘/é€šä¹‰ä¸‡ç›¸ï¼ˆå›¾åƒç”Ÿæˆï¼‰
2. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
3. **ç°ä»£åŒ–æ¶æ„**: Next.js 16 App Router
4. **å“åº”å¼è®¾è®¡**: Tailwind CSSå®ç”¨ä¼˜å…ˆï¼Œæ”¯æŒç§»åŠ¨ç«¯
5. **SPAä½“éªŒ**: å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œæµç•…äº¤äº’
6. **ç”¨æˆ·ç³»ç»Ÿ**: åŸºäºlocalStorageçš„æ¼”ç¤ºçº§è®¤è¯ä¸ä½œå“ç®¡ç†
7. **å›¾ç‰‡ç®¡ç†**: è‡ªåŠ¨å­˜å‚¨å’Œæ¸…ç†è¿‡æœŸå›¾ç‰‡
8. **ä¸‹è½½åŠŸèƒ½**: æ”¯æŒå•å¼ å’Œæ‰¹é‡ä¸‹è½½ï¼ˆZIPæ‰“åŒ…ï¼‰
9. **ç½‘ç»œå‹å¥½**: æ”¯æŒå±€åŸŸç½‘è®¿é—®ï¼Œä¾¿äºå›¢é˜Ÿåä½œ
10. **çŠ¶æ€æŒä¹…åŒ–**: ä½¿ç”¨localStorageå’ŒsessionStorage

---

## ğŸ“š ä¾èµ–ç‰ˆæœ¬

### ç”Ÿäº§ä¾èµ–
- next: ^16.0.7
- react: ^18.3.1
- react-dom: ^18.3.1
- axios: ^1.6.0
- openai: ^4.20.0
- jszip: ^3.10.1

### å¼€å‘ä¾èµ–
- typescript: ^5.0.0
- @types/node: ^20.0.0
- @types/react: ^18.3.0
- @types/react-dom: ^18.3.0
- @types/jszip: ^3.4.1
- tailwindcss: ^3.3.0
- postcss: ^8.4.0
- autoprefixer: ^10.4.0
- eslint: ^9.39.1
- eslint-config-next: ^16.0.7
- vitest: ^1.5.0
- jsdom: ^24.x
- @testing-library/react: ^14.x
- @testing-library/jest-dom: ^6.x

---

## ğŸ” æŠ€æœ¯æ ˆæ€»ç»“

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|------|
| æ¡†æ¶ | Next.js | 16.0.7 | å…¨æ ˆReactæ¡†æ¶ |
| UIåº“ | React | 18.3.1 | ç”¨æˆ·ç•Œé¢ |
| è¯­è¨€ | TypeScript | 5.0.0 | ç±»å‹å®‰å…¨ |
| æ ·å¼ | Tailwind CSS | 3.3.0 | æ ·å¼æ¡†æ¶ |
| HTTP | Axios | 1.6.0 | APIè°ƒç”¨ |
| å·¥å…· | JSZip | 3.10.1 | ZIPæ‰“åŒ… |
| AIæœåŠ¡ | DashScope æ–‡æœ¬ç”Ÿæˆ | - | å¤§çº²/å‰§æœ¬/åˆ†é•œç”Ÿæˆ |
| AIæœåŠ¡ | ä¸ƒç‰›äº‘API | - | å›¾åƒç”Ÿæˆ |
| æ„å»º | Next.js Build | - | æ„å»ºå·¥å…· |
| ä»£ç æ£€æŸ¥ | ESLint | 9.39.1 | ä»£ç è´¨é‡ |

---

## ğŸ“± é¡µé¢è§†å›¾æ¨¡å¼

é¡¹ç›®æ”¯æŒä»¥ä¸‹è§†å›¾æ¨¡å¼ï¼ˆViewModeï¼‰ï¼š
- `home` - é¦–é¡µ
- `script` - è„šæœ¬ç”Ÿæˆ
- `comic` - ç»˜æœ¬ç”Ÿæˆ
- `edit` - è„šæœ¬ç¼–è¾‘
- `library` - ä½œå“åº“
- `ai-create` - AIåˆ›ä½œ
- `my-works` - æˆ‘çš„ä½œå“
- `characters` - è§’è‰²ç®¡ç†
- `view-comic` - æŸ¥çœ‹æ¼«ç”»
- `personal` - ä¸ªäººä¸­å¿ƒ

---

## ğŸ—‚ï¸ å­˜å‚¨ç»“æ„

### localStorageé”®
- `comic_scripts` - ä¿å­˜çš„è„šæœ¬åˆ—è¡¨
- `comic_books` - ä¿å­˜çš„æ¼«ç”»ä¹¦åˆ—è¡¨
- `current_user` - å½“å‰ç”¨æˆ·ä¿¡æ¯
- `is_logged_in` - ç™»å½•çŠ¶æ€
- `users` - ç”¨æˆ·åˆ—è¡¨
- `user_passwords` - ç”¨æˆ·å¯†ç ï¼ˆå®é™…åº”ç”¨åº”åŠ å¯†ï¼‰

### sessionStorageé”®
- `currentViewMode` - å½“å‰è§†å›¾æ¨¡å¼ï¼ˆç”¨äºçŠ¶æ€æ¢å¤ï¼‰

### æ–‡ä»¶ç³»ç»Ÿ
- `public/comic-assets/` - æ¼«ç”»å›¾ç‰‡å­˜å‚¨ç›®å½•
- `public/comic-assets/*.meta.json` - å›¾ç‰‡å…ƒæ•°æ®æ–‡ä»¶

---

## ğŸš§ å½“å‰é™åˆ¶ä¸ä¸Šçº¿å‰å¾…åŠ

- è®¤è¯ä¸ç”¨æˆ·æ•°æ®ä»…å­˜ localStorageï¼Œæ— åç«¯é‰´æƒ/åŠ å¯†ï¼Œä¸å¯ç›´æ¥ç”¨äºç”Ÿäº§ã€‚
- å›¾ç‰‡ä¸å…ƒæ•°æ®å­˜äºå…¬å¼€é™æ€ç›®å½• `public/comic-assets/`ï¼Œéœ€æ›´æ¢ä¸ºå¯¹è±¡å­˜å‚¨å¹¶åŠ è®¿é—®æ§åˆ¶ã€‚
- API æœªåŠ é‰´æƒã€é™æµã€å®¡è®¡ä¸é”™è¯¯æ©ç ï¼Œä¸Šçº¿å‰éœ€è¡¥å……ã€‚
- ä¸ƒç‰›/DeepSeek å¯†é’¥éœ€é€šè¿‡ç¯å¢ƒå˜é‡æä¾›ï¼›å¼€å‘å›é€€å¯†é’¥å¿…é¡»ç§»é™¤æˆ–è¦†ç›–ã€‚
- ç¼ºå°‘ç”Ÿäº§éƒ¨ç½²è„šæœ¬ã€ç›‘æ§/æ—¥å¿—ä¸è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä¸Šçº¿å‰éœ€è¡¥é½ã€‚

---

*æœ€åæ›´æ–°: 2025-12-14*
