# SPA 架构转换说明

## 转换概述

项目已从 Next.js 多页应用模式转换为**单页应用（SPA）架构**。

## 当前架构状态

### ✅ 已完成的转换

1. **客户端渲染**
   - `app/layout.tsx` 已改为客户端组件（`'use client'`）
   - `app/page.tsx` 已经是客户端组件
   - 所有页面组件都在客户端渲染

2. **路由方式**
   - 使用 React state 进行视图切换（`viewMode`）
   - 不依赖 Next.js 路由系统进行页面切换
   - 所有视图切换都在客户端完成，无需服务器往返

3. **API 路由保留**
   - API 路由（`/api/script/generate` 和 `/api/comic/generate`）仍然在服务端运行
   - 这样可以安全地处理 API 密钥，不会暴露到客户端
   - 客户端通过 `fetch` 调用这些 API 路由

## 架构特点

### SPA 优势

1. **快速导航**：视图切换无需页面刷新，用户体验流畅
2. **状态保持**：应用状态在视图切换时保持
3. **减少服务器负载**：大部分逻辑在客户端执行

### 混合架构

虽然前端是 SPA，但保留了 Next.js 的 API 路由功能：
- ✅ 前端：纯客户端 SPA
- ✅ 后端：Next.js API 路由（用于安全处理 API 密钥）

## 文件变更

### 修改的文件

1. **`app/layout.tsx`**
   - 添加 `'use client'` 指令
   - 使用 `useEffect` 在客户端设置页面元数据
   - 移除了服务端 `Metadata` 导出

2. **`next.config.js`**
   - 添加了 SPA 模式说明注释

## 运行方式

运行方式保持不变：

```bash
# 开发模式
npm run dev

# 生产构建
npm run build
npm start
```

## 注意事项

### API 密钥安全

- API 密钥（`DEEPSEEK_API_KEY`）仍然在服务端处理
- 客户端不会暴露 API 密钥
- 如果完全静态导出，需要将 API 调用改为直接调用外部服务（不推荐，会暴露密钥）

### 如果需要完全静态导出

如果将来需要完全静态导出（`output: 'export'`），需要：

1. 移除所有 API 路由
2. 创建独立的后端服务来处理 API 调用
3. 客户端直接调用外部后端服务

⚠️ **警告**：完全静态导出会失去 API 路由功能，需要额外的后端服务。

## 总结

项目现在是一个**混合架构**：
- **前端**：纯客户端 SPA（快速、流畅）
- **后端**：Next.js API 路由（安全、便捷）

这种架构结合了 SPA 的用户体验优势和 Next.js 的服务端 API 功能，是当前的最佳实践。
